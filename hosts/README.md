# Adding a New Host (Machine/Profile)

The `flake.nix` automatically finds new hosts added here.

## How-To

1.  **Make a Host Folder:**
    In *this* `hosts/` directory, create a new folder. Name it after your host (e.g., `my-server`).
    ```
    hosts/
    └── my-server/  <-- Your new host's folder
    ```

2.  **Add `system.nix`:**
    Inside the new host folder (e.g., `hosts/my-server/`), create `system.nix`. This file just needs one string: the system architecture.

    *   For Intel/AMD (64-bit):
        ```nix
        // hosts/my-server/system.nix
        "x86_64-linux"
        ```
    *   For ARM (64-bit):
        ```nix
        // hosts/my-server/system.nix
        "aarch64-linux"
        ```

3.  **Add Config Files:**
    Still in your host's folder (e.g., `hosts/my-server/`), create these:

    *   `configuration.nix` (for full NixOS setups):
        This file is mainly for importing `./hardware-configuration.nix` and `./home.nix`. Most system-wide settings come from modules (see `../modules/README.md`).
        However, you *can* put host-specific NixOS options or one-off packages here if you don't want to create a full module for them.
        ```nix
        // hosts/my-server/configuration.nix
        {
          imports = [
            ./hardware-configuration.nix
            ./home.nix
            # System-specific modules are usually enabled in flake.nix or home.nix
          ];

          # Example: Host-specific override or quick package add
          # services.openssh.port = 2222;
          # environment.systemPackages = [ pkgs.htop ];
          # system.stateVersion = "24.11"; 
        }
        ```

    *   `home.nix` (for Home Manager settings):
        This is where you enable and configure the shared modules (from `../modules/`) for this user. All modules are designed to be compatible with both standalone Home Manager and NixOS integration.
        ```nix
        // hosts/my-server/home.nix
        {
          primaryUser = "your-username"; // IMPORTANT: Change this!

          modules.home = { // Basic Home Manager setup
            enable = true;
            enableCli = true;
            stateVersion = "24.11";
          };

          # Enable and configure your shared modules here
          # modules.git.enable = true;
          # modules.neovim = {
          #   enable = true;
          #   someNeovimOption = true;
          # };
        }
        ```

    *   `hardware-configuration.nix` (for full NixOS setups):
        Hardware-specifics (disks, bootloader). Generated by `nixos-generate-config` during NixOS install. Copy it from `/etc/nixos/hardware-configuration.nix` for a new machine.
        *Standalone Home Manager profiles (not full NixOS) usually don't need `configuration.nix` or `hardware-configuration.nix`. `home.nix` and `system.nix` are key.* 

4.  **Best Practice: Use Modules!**
    If you find yourself wanting to add a new application, service, or a group of related settings, it's generally better to create or modify a module in the `../modules/` directory. This keeps your configuration organized, reusable, and easier to manage across different hosts.
    See the [Modules README](../modules/README.md) for more on how to work with modules.

5.  **`flake.nix` (Nothing to do!):**
    The main `flake.nix` automatically finds your new host folder and its `system.nix`. No manual edits needed there.

6.  **Build It:**
    Now you can build for your new host:

    *   NixOS + Home Manager:
        ```bash
        sudo nixos-rebuild switch --flake .#my-server 
        ```
    *   Standalone Home Manager:
        ```bash
        home-manager switch --flake .#my-server
        ```
    *(Replace `my-server` with your actual host folder name)*

Done! Commit your new files to Git when you're happy with them.
